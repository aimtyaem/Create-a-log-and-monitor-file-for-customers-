<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.89.4" />
    <meta name="description" content="Open Search Log Analytics Workshop">
<meta name="author" content="Chris Sharkey">

    <link rel="icon" href="../images/favicon.png" type="image/png">

    <title>2. Environment Set Up :: Open Search Log Analytics Workshop</title>

    
    <link href="../css/nucleus.css" rel="stylesheet">
    <link href="../css/fontawesome-all.min.css" rel="stylesheet">
    <link href="../css/hybrid.css" rel="stylesheet">
    <link href="../css/featherlight.min.css" rel="stylesheet">
    <link href="../css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="../css/auto-complete.css" rel="stylesheet">
    <link href="../css/atom-one-dark-reasonable.css" rel="stylesheet">
    <link href="../css/theme.css" rel="stylesheet">
    <link href="../css/hugo-theme.css" rel="stylesheet">
    
    <link href="../css/theme-aws.css" rel="stylesheet">
    
    

    <script src="../js/jquery-3.3.1.min.js"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="../open-search-log-analytics/2_enviorment_set_up.html">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <div id="logo">
  <img stlye="vertical-align:middle" src="https://sharkech-public.s3.amazonaws.com/misc-public/aws_logo.png" height="70px">
</div>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="../js/lunr.min.js"></script>
<script type="text/javascript" src="../js/auto-complete.js"></script>
<script type="text/javascript">
    
        var baseurl = "";
    
</script>
<script type="text/javascript" src="../js/search.js"></script>

    
  </div>
  
    <section id="homelinks">
      <ul>
        <li>
            <a class="padding" href='../index.html'><i class='fas fa-home'></i> Home</a>
        </li>
      </ul>
    </section>
  

    <div class="highlightable">
    <ul class="topics">
        
          
          




 
  
    
    <li data-nav-id="/open-search-log-analytics/" title="1. OpenSearch Log Analytics" class="dd-item
        parent
        
        
        ">
      <a href="../open-search-log-analytics/index.html">
          OpenSearch Log Analytics
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/open-search-log-analytics/1_getting_started.html" title="1. Getting started" class="dd-item
        
        
        
        ">
      <a href="../open-search-log-analytics/1_getting_started.html">
          Getting started
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/open-search-log-analytics/1_getting_started/aws_event.html" title="AWS Event" class="dd-item ">
        <a href="../open-search-log-analytics/1_getting_started/aws_event.html">
        AWS Event
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/open-search-log-analytics/1_getting_started/self_paced.html" title="Self Paced" class="dd-item ">
        <a href="../open-search-log-analytics/1_getting_started/self_paced.html">
        Self Paced
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/open-search-log-analytics/2_enviorment_set_up.html" title="2. Environment Set Up" class="dd-item
        parent
        active
        
        ">
      <a href="../open-search-log-analytics/2_enviorment_set_up.html">
          Environment Set Up
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/open-search-log-analytics/3_send_log_data_to_kinesis_fire_hose.html" title="3. Send Log Data to Kinesis Fire Hose" class="dd-item
        
        
        
        ">
      <a href="../open-search-log-analytics/3_send_log_data_to_kinesis_fire_hose.html">
          Send Log Data to Kinesis Fire Hose
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/open-search-log-analytics/4_visualize_analyze.html" title="4. Visualize and Analyze" class="dd-item
        
        
        
        ">
      <a href="../open-search-log-analytics/4_visualize_analyze.html">
          Visualize and Analyze
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/open-search-log-analytics/5_clean_up.html" title="5. Clean Up" class="dd-item
        
        
        
        ">
      <a href="../open-search-log-analytics/5_clean_up.html">
          Clean Up
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/collect-log-cloud-watch/" title="2. CloudWatch Log Collection" class="dd-item
        
        
        
        ">
      <a href="../collect-log-cloud-watch/index.html">
          CloudWatch Log Collection
          
      </a>
      
      
        <ul>
          
          
            
          
          

        
          
            
            




 
  
    
    <li data-nav-id="/collect-log-cloud-watch/1_getting_started.html" title="1. Getting started" class="dd-item
        
        
        
        ">
      <a href="../collect-log-cloud-watch/1_getting_started.html">
          Getting started
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/collect-log-cloud-watch/1_getting_started/aws_event.html" title="AWS Event" class="dd-item ">
        <a href="../collect-log-cloud-watch/1_getting_started/aws_event.html">
        AWS Event
        
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/collect-log-cloud-watch/1_getting_started/self_paced.html" title="Self Paced" class="dd-item ">
        <a href="../collect-log-cloud-watch/1_getting_started/self_paced.html">
        Self Paced
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/collect-log-cloud-watch/2_enviorment_set_up.html" title="2. Environment Set Up" class="dd-item
        
        
        
        ">
      <a href="../collect-log-cloud-watch/2_enviorment_set_up.html">
          Environment Set Up
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/collect-log-cloud-watch/3_send_log_data_to_opensearch.html" title="3. Send Log Data to OpenSearch" class="dd-item
        
        
        
        ">
      <a href="../collect-log-cloud-watch/3_send_log_data_to_opensearch.html">
          Send Log Data to OpenSearch
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/collect-log-cloud-watch/4_search_logs.html" title="4. Search Logs" class="dd-item
        
        
        
        ">
      <a href="../collect-log-cloud-watch/4_search_logs.html">
          Search Logs
          
      </a>
      
      
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/collect-log-cloud-watch/5_clean_up.html" title="5. Clean Up" class="dd-item
        
        
        
        ">
      <a href="../collect-log-cloud-watch/5_clean_up.html">
          Clean Up
          
      </a>
      
      
    </li>
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    
      <section id="shortcuts">
        <h3></h3>
        <ul>
          
              <li>
                  <a class="padding" href="https://github.com/ev2900/OpenSearch_Log_Analytics/"><i class='fab fa-github'></i> GitHub Project</a>
              </li>
          
              <li>
                  <a class="padding" href="mailto:sharkech@amazon.com"><i class='fas fa-envelope'></i> Have questions?</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>
<div style="height:25px">
  
</div>
    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link"></div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='../'>OpenSearch Log Analytics Workshop</a> > <a href='../open-search-log-analytics/index.html'>OpenSearch Log Analytics</a> > Environment Set Up
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              2. Environment Set Up
            </h1>
          

        



	<p>We will need to deploy a few services and configure our AWS environment before we can get started with log analytics.</p>
<p>We will need to compelete the following set up steps</p>
<ol>
<li>Create an OpenSearch Domain</li>
<li>Create a Kinesis Firehose</li>
<li>Configure Identity Access Management Premisions</li>
</ol>
<p>Follow the instructions below for each step</p>
<h4 id="create-an-opensearch-domain">Create an OpenSearch Domain</h4>
<ol>
<li>Go to the <a href="https://console.aws.amazon.com/esv3/home">OpenSearch Console</a></li>
<li>Click on <strong>Create domain</strong></li>
</ol>
<p><img src="../images/open-search-log-analytics/set_up_1.PNG" alt="cloud_shell_button"></p>
<ol start="3">
<li>Enter the name <code>workshop-domain</code> for the OpenSearch Domain</li>
<li>Under the deployment type section, select <code>Development and testing</code></li>
<li>Under the network section, select <code>Public access</code></li>
<li>Under the fine-grained access control section select <code>Create master user</code></li>
<li>Enter and username and password. Copy down the user name and password. We will need these later in the workshop</li>
<li>Leave all other settings at the default selections</li>
<li>Click on <strong>Create</strong></li>
</ol>
<p>It will take approximately 5 - 10 minutes for your OpenSearch domain to be created. Upon sucssful creation you will see your OpenSearch domain status is active</p>
<p><img src="../images/open-search-log-analytics/set_up_2.PNG" alt="cloud_shell_button">
Do not proceed to the next step until you confirm that your domain status is active</p>
<h4 id="create-a-kinesis-firehose">Create a Kinesis Firehose</h4>
<ol>
<li>Go to the <a href="https://console.aws.amazon.com/firehose/home">Kinesis Firehose Console</a></li>
<li>Click on <strong>Create delivery stream</strong></li>
</ol>
<p><img src="../images/open-search-log-analytics/kfh_1.PNG" alt="create_delivery_stream"></p>
<ol start="3">
<li>Under the choose source and destination section for the source, select <code>Direct PUT</code> for the desintation select <code>Amazon OpenSearch Service</code></li>
<li>Under the delivery stream name section name the stream <code>workshop-firehose</code></li>
</ol>
<p><img src="../images/open-search-log-analytics/kfh_2.PNG" alt="select_source_destination"></p>
<ol start="5">
<li>Under the destination settings for the OpenSearch service domain, click on <strong>Browse</strong> and select the OpenSearch domain <strong>workshop-domain</strong> this is the OpenSearch domain we created in the previous step</li>
<li>Name the index <code>workshop-log</code></li>
<li>Select  <code>Every hour</code> for the Index rotation. This will produce a next index every hour</li>
</ol>
<p><img src="../images/open-search-log-analytics/kfh_3.PNG" alt="index_rotation"></p>
<ol start="8">
<li>Expand the <strong>Buffer hints</strong> section</li>
<li>Adjust the buffer interval to <code>60</code> seconds. This will write data from Kinesis Firehose to OpenSearch every 60 seconds</li>
</ol>
<p><img src="../images/open-search-log-analytics/kfh_4.PNG" alt="buffer_hints"></p>
<ol start="10">
<li>Under the backup settings under the S3 backup bucket click on <strong>Create</strong>. This will (in a new browser window) open the create S3 bucket web page</li>
</ol>
<p><img src="../images/open-search-log-analytics/kfh_5.PNG" alt="back_up_create_s3"></p>
<ol start="11">
<li>On the create bucket page provide a bucket name. You may name the bucket any valid name</li>
<li>Click on <strong>Create bucket</strong> at the bottom of the page. Leaving all of the S3 settings the the default selections</li>
<li>Return the browser window that we were using to configure our Kinesis Firehose and under the backup setting section for the S3 backup bucket, click on <strong>Browse</strong></li>
<li>Select the bucket you just created. If you do not see the bucket listed click on the small refresh button in the top right corner of the window that pops us when you click on the browse button</li>
</ol>
<p><img src="../images/open-search-log-analytics/kfh_6.PNG" alt="back_up_select_s3"></p>
<ol start="15">
<li>At the bottom of the page click on <strong>Create delivery stream</strong> leave all other settings at the default selections</li>
</ol>
<h4 id="configure-identity-access-management-iam-premisions">Configure Identity Access Management (IAM) Premisions</h4>
<p>In the first step we created an OpenSearch domain. We can send logs to the OpenSearch domin via. the Kinesis Data Firehose we just created</p>
<p>However before we can start to send sample log data to OpenSearch (via Kinesis Data Firehose) we need to configure premissions in IAM and in OpenSearch</p>
<h5 id="adjust-opensearch-access-policy">Adjust OpenSearch Access Policy</h5>
<ol>
<li>Go to the <a href="https://console.aws.amazon.com/esv3/home">OpenSearch Console</a></li>
<li>Click on the <strong>workshop-domain</strong> OpenSearch domain you created earlier</li>
</ol>
<p><img src="../images/open-search-log-analytics/IAM_1.PNG" alt="select_domain"></p>
<ol start="3">
<li>Click on <strong>Security configuration</strong></li>
<li>Under the security configuration window click on <strong>Edit</strong></li>
</ol>
<p><img src="../images/open-search-log-analytics/IAM_2.PNG" alt="security_configuration"></p>
<ol start="5">
<li>Naviage to the access policy section of the edit security configuration window</li>
<li>Adjust the JSON access policy to switch the Deny to an <code>Allow</code></li>
</ol>
<p><img src="../images/open-search-log-analytics/IAM_3.PNG" alt="access_policy"></p>
<ol start="7">
<li>Click on <strong>Save changes</strong> at the bottom of the page</li>
</ol>
<h5 id="map-iam-role-with-openseach-role">Map IAM Role with OpenSeach Role</h5>
<ol>
<li>Go to the <a href="https://console.aws.amazon.com/esv3/home">OpenSearch Console</a></li>
<li>Click on the <strong>workshop-domain</strong> OpenSearch domain you created earlier</li>
<li>Click on the OpenSearch Dashboard URL. This should open the URL in a web browser window</li>
</ol>
<p><img src="../images/open-search-log-analytics/IAM_4.PNG" alt="open_search_dashboard"></p>
<ol start="4">
<li>You will be prompted to log in. Using the user name and password you created during the OpenSearch deployment, log in</li>
<li>If an additonal pop up window is present after login asking about data upload click on <strong>Explore on my own</strong></li>
<li>If an additonal pop up windows is present asking you to select your tenant select <strong>Global</strong> and click on <strong>Confirm</strong></li>
</ol>
<p>You should now see a window that looks like this</p>
<p><img src="../images/open-search-log-analytics/os_1.PNG" alt="select_domain"></p>
<ol start="7">
<li>Click on and expand the hamburger menu on the side bar of the OpenSearch home page</li>
<li>Under the OpenSearch Plugins section click on <strong>Security</strong></li>
</ol>
<p><img src="../images/open-search-log-analytics/os_2.PNG" alt="select_security"></p>
<ol start="9">
<li>On the security page click on <strong>Roles</strong> from the left hand menu</li>
</ol>
<p><img src="../images/open-search-log-analytics/os_3.PNG" alt="select_roles"></p>
<ol start="10">
<li>On the roles page search for and click on <code>all_access</code></li>
</ol>
<p><img src="../images/open-search-log-analytics/os_4.PNG" alt="search_all_access"></p>
<ol start="11">
<li>On the all_access role page click on <strong>Mapped users</strong></li>
<li>Under the mapped users page click on <strong>Manage mapping</strong></li>
</ol>
<p><img src="../images/open-search-log-analytics/os_5.PNG" alt="mapped_users"></p>
<p>On the manage mapping page we need to map the IAM role the is used by Kinesis Data Firehose to the all_access OpenSearch role. This will give Kinesis Firehose the premissions it need to create and update indexes.</p>
<p>For the purposes of this lab we will give Kinesis Firehose all_access in OpenSearch. <strong>In a production environment it is recomended to scope down the premisions Kinesis Firehose has within OpenSearch</strong></p>
<p>We need to find the ARN of the IAM role Kinesis Firehose is using. Keeping the <strong>Manage mapping</strong> page open, navigate to a new tab and:</p>
<ol start="13">
<li>Go to the <a href="https://console.aws.amazon.com/firehose/home">Kinesis Firehose Console</a></li>
<li>Click on the <strong>workshop-firehose</strong> listed. This is the Kinesis Data Fire hose we created earlier</li>
<li>Click on the <strong>Configuration</strong> section</li>
</ol>
<p><img src="../images/open-search-log-analytics/os_6.PNG" alt="IAM_role"></p>
<ol start="16">
<li>On the configuration page scroll down to the premissions section</li>
<li>Click on the IAM role</li>
</ol>
<p><img src="../images/open-search-log-analytics/os_7.PNG" alt="IAM_role"></p>
<ol start="18">
<li>This will open a new window in your web browser. Copy down the ARN of the IAM role</li>
</ol>
<p><img src="../images/open-search-log-analytics/os_8.PNG" alt="IAM_role"></p>
<ol start="19">
<li>Navigate back to the OpenSearch map user tab</li>
<li>Enter the ARN we copied in step 18 and paste it in the backend roles section of OpenSearch console page</li>
<li>Click on <strong>Map</strong></li>
</ol>
<p><img src="../images/open-search-log-analytics/os_9.PNG" alt="IAM_role"></p>
<p>Our AWS environment set up is now complete! When you are ready lets begin the next step <a href="../open-search-log-analytics/3_send_log_data_to_kinesis_fire_hose.html">Send Log Data to Kinesis Fire Hose</a></p>





<footer class=" footline" >
	
</footer>

        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="../open-search-log-analytics/1_getting_started/self_paced.html" title="Self Paced"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="../open-search-log-analytics/3_send_log_data_to_kinesis_fire_hose.html" title="3. Send Log Data to Kinesis Fire Hose" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="../js/clipboard.min.js"></script>
    <script src="../js/perfect-scrollbar.min.js"></script>
    <script src="../js/perfect-scrollbar.jquery.min.js"></script>
    <script src="../js/jquery.sticky.js"></script>
    <script src="../js/featherlight.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../js/modernizr.custom-3.6.0.js"></script>
    <script src="../js/learn.js"></script>
    <script src="../js/hugo-learn.js"></script>
    
        
            <script src="../mermaid/mermaid.js"></script>
        
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>
    
    

  </body>
</html>
